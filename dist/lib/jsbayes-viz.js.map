{"version":3,"sources":["../../src/lib/jsbayes-viz.js"],"names":["window","dagre","d3","jsbayes","OUT_LEFT","OUT_TOP","OUT_RIGHT","OUT_BOTTOM","getPath","n1","n2","c1","center","c2","x1","x","y1","y","x2","y2","theta","Math","atan2","p1","getPoint","p2","PI","error","n","c","cx","cy","w","width","h","height","d","distance","cos","sin","ocode","outcode","p","console","node","sqrt","out","newGraph","nodes","edges","addEdge","parent","child","edge","push","addNode","id","label","values","probs","length","random","mid","dx","dy","translate","map","nodeMap","i","id1","id2","path","getDagreGraph","graph","g","graphlib","Graph","setGraph","setDefaultEdgeLabel","setNode","e","setEdge","layoutGraph","layout","gout","gin","eout","v","ein","points","initSvg","options","select","attr","append","markerWidth","markerHeight","refX","refY","orient","markerUnits","fill","class","formatValue","MAX","subchar","value","substr","formatPct","pct","toFixed","formatNodeName","name","drawNodeBars","nOut","nIn","j","prob","selector","text","drawNodes","SAMPLES","samples","selectAll","data","enter","transform","on","sort","a","b","style","each","attributes","undefined","isObserved","observe","index1","valueIndex","index2","unobserve","sample","then","r","xInc","drag","behavior","origin","event","sourceEvent","stopPropagation","arcs","call","drawEdges","drawGraph","redrawGraph","normalize","sampledLw","sum","downloadData","filename","link","document","createElement","href","download","body","appendChild","click","removeChild","defineLib","lib","fromGraph","parents","draw","redraw","redrawProbs","downloadSamples","asJson","encodeURIComponent","JSON","stringify","Date","now","csv","samplesAsCsv","module","exports","require","jsbayesviz","define","amd"],"mappings":";;;;;;;;;;;;;;;AAAA,OAAC,UAASA,MAAT,EAAiB;AAChB;;AACA,YAAIC,KAAJ;AACA,YAAIC,EAAJ;AACA,YAAIC,OAAJ;AACA,YAAIC,WAAW,CAAf;AAAA,YACIC,UAAU,CADd;AAAA,YAEIC,YAAY,CAFhB;AAAA,YAGIC,aAAa,CAHjB;;AAKA,iBAASC,OAAT,CAAiBC,EAAjB,EAAqBC,EAArB,EAAyB;AACvB,cAAIC,KAAKC,OAAOH,EAAP,CAAT;AAAA,cACII,KAAKD,OAAOF,EAAP,CADT;AAEA,cAAII,KAAKH,GAAGI,CAAZ;AAAA,cACIC,KAAKL,GAAGM,CADZ;AAAA,cAEIC,KAAKL,GAAGE,CAFZ;AAAA,cAGII,KAAKN,GAAGI,CAHZ;AAAA,cAIIG,QAAQC,KAAKC,KAAL,CAAWH,KAAKH,EAAhB,EAAoBE,KAAKJ,EAAzB,CAJZ;AAKA,cAAIS,KAAKC,SAASJ,KAAT,EAAgBX,EAAhB,CAAT;AAAA,cACIgB,KAAKD,SAASJ,QAAQC,KAAKK,EAAtB,EAA0BhB,EAA1B,CADT;AAEA,cAAGa,GAAGI,KAAH,IAAYF,GAAGE,KAAlB,EAAyB;AACvB,mBAAO,EAACb,IAAI,CAAL,EAAQE,IAAI,CAAZ,EAAeE,IAAI,CAAnB,EAAsBC,IAAI,CAA1B,EAA6BQ,OAAO,IAApC,EAAP;AACD;AACD,iBAAO,EAAEb,IAAIS,GAAGR,CAAT,EAAYC,IAAIO,GAAGN,CAAnB,EAAsBC,IAAIO,GAAGV,CAA7B,EAAgCI,IAAIM,GAAGR,CAAvC,EAAP;AACD;AACD,iBAASO,QAAT,CAAkBJ,KAAlB,EAAyBQ,CAAzB,EAA4B;AAC1B,cAAIC,IAAIjB,OAAOgB,CAAP,CAAR;AACA,cAAIE,KAAKD,EAAEd,CAAX;AACA,cAAIgB,KAAKF,EAAEZ,CAAX;AACA,cAAIe,IAAIJ,EAAEK,KAAF,GAAU,GAAlB;AACA,cAAIC,IAAIN,EAAEO,MAAF,GAAW,GAAnB;AACA,cAAIC,IAAIC,SAASP,EAAT,EAAaC,EAAb,EAAiBD,KAAGE,CAApB,EAAuBD,KAAGG,CAA1B,CAAR;AACA,cAAInB,IAAIe,KAAKM,IAAIf,KAAKiB,GAAL,CAASlB,KAAT,CAAjB;AACA,cAAIH,IAAIc,KAAKK,IAAIf,KAAKkB,GAAL,CAASnB,KAAT,CAAjB;AACA,cAAIoB,QAAQC,QAAQb,CAAR,EAAWb,CAAX,EAAcE,CAAd,CAAZ;AACA,cAAIyB,IAAI,EAAR;AACA,kBAAOF,KAAP;AACE,iBAAKnC,OAAL;AACEqC,gBAAE3B,CAAF,GAAMe,KAAKI,KAAG,CAACnB,IAAEe,EAAH,KAAQb,IAAEc,EAAV,CAAH,CAAX;AACAW,gBAAEzB,CAAF,GAAMc,KAAKG,CAAX;AACA;AACF,iBAAK9B,QAAL;AACEsC,gBAAE3B,CAAF,GAAMe,KAAKE,CAAX;AACAU,gBAAEzB,CAAF,GAAMc,KAAKC,KAAG,CAACf,IAAEc,EAAH,KAAQhB,IAAEe,EAAV,CAAH,CAAX;AACA;AACF,iBAAKvB,UAAL;AACEmC,gBAAE3B,CAAF,GAAMe,KAAKI,KAAG,CAACnB,IAAEe,EAAH,KAAQb,IAAEc,EAAV,CAAH,CAAX;AACAW,gBAAEzB,CAAF,GAAMc,KAAKG,CAAX;AACA;AACF,iBAAK5B,SAAL;AACEoC,gBAAE3B,CAAF,GAAMe,KAAKE,CAAX;AACAU,gBAAEzB,CAAF,GAAMc,KAAKC,KAAG,CAACf,IAAEc,EAAH,KAAQhB,IAAEe,EAAV,CAAH,CAAX;AACA;AACF;AACEa,sBAAQhB,KAAR,CAAc,0BAA0Ba,KAAxC;AACAE,gBAAEf,KAAF,GAAU,IAAV;AAnBJ;AAqBA,iBAAOe,CAAP;AACD;AACD,iBAAS9B,MAAT,CAAgBgC,IAAhB,EAAsB;AACpB,cAAI7B,IAAI6B,KAAKX,KAAL,GAAa,GAAb,GAAmBW,KAAK7B,CAAhC;AAAA,cACIE,IAAI2B,KAAKT,MAAL,GAAc,GAAd,GAAoBS,KAAK3B,CADjC;AAEA,iBAAO,EAAEF,GAAGA,CAAL,EAAQE,GAAGA,CAAX,EAAP;AACD;AACD,iBAASoB,QAAT,CAAkBvB,EAAlB,EAAsBE,EAAtB,EAA0BE,EAA1B,EAA8BC,EAA9B,EAAkC;AAChC,cAAIJ,IAAID,KAAKI,EAAb;AACA,cAAID,IAAID,KAAKG,EAAb;AACA,cAAIiB,IAAIf,KAAKwB,IAAL,CAAU9B,IAAEA,CAAF,GAAME,IAAEA,CAAlB,CAAR;AACA,iBAAOmB,CAAP;AACD;AACD,iBAASK,OAAT,CAAiBb,CAAjB,EAAoBb,CAApB,EAAuBE,CAAvB,EAA0B;AACxB,cAAI6B,MAAM,CAAV;AACA,cAAGlB,EAAEK,KAAF,IAAW,CAAd,EAAiB;AACfa,mBAAO1C,WAAWE,SAAlB;AACD,WAFD,MAEO,IAAGS,IAAIa,EAAEb,CAAT,EAAY;AACjB+B,mBAAO1C,QAAP;AACD,WAFM,MAEA,IAAGW,IAAIa,EAAEb,CAAF,GAAMa,EAAEK,KAAf,EAAsB;AAC3Ba,mBAAOxC,SAAP;AACD;;AAED,cAAGsB,EAAEO,MAAF,IAAY,CAAf,EAAkB;AAChBW,mBAAOzC,UAAUE,UAAjB;AACD,WAFD,MAEO,IAAGU,IAAIW,EAAEX,CAAT,EAAY;AACjB6B,mBAAOzC,OAAP;AACD,WAFM,MAEA,IAAGY,IAAIW,EAAEX,CAAF,GAAMW,EAAEO,MAAf,EAAuB;AAC5BW,mBAAOvC,UAAP;AACD;AACD,iBAAOuC,GAAP;AACD;AACD,iBAASC,QAAT,GAAoB;AAClB,iBAAO;AACLC,mBAAO,EADF;AAELC,mBAAO,EAFF;AAGLC,qBAAS,iBAASC,MAAT,EAAiBC,KAAjB,EAAwB;AAC/B,kBAAIC,OAAO;AACTF,wBAAQA,MADC;AAETC,uBAAOA;AAFE,eAAX;AAIA,mBAAKH,KAAL,CAAWK,IAAX,CAAgBD,IAAhB;AACA,qBAAOA,IAAP;AACD,aAVI;AAWLE,qBAAS,iBAASC,EAAT,EAAaC,KAAb,EAAoBC,MAApB,EAA4BC,KAA5B,EAAmC;AAC1C,kBAAI1B,QAAQ,GAAZ;AACA,kBAAIE,SAASuB,OAAOE,MAAP,GAAgB,EAAhB,GAAqB,EAAlC;AACA,kBAAIhB,OAAO;AACTY,oBAAIA,EADK;AAETC,uBAAOA,KAFE;AAGTC,wBAAQA,MAHC;AAITC,uBAAOA,KAJE;AAKT1B,uBAAOA,KALE;AAMTE,wBAAQA,MANC;AAOTpB,mBAAGM,KAAKwC,MAAL,EAPM;AAQT5C,mBAAGI,KAAKwC,MAAL,EARM;AASTC,qBAAK,eAAW;AACd,sBAAIC,KAAK,KAAK9B,KAAL,GAAa,GAAb,GAAmB,KAAKlB,CAAjC;AAAA,sBACIiD,KAAK,KAAK7B,MAAL,GAAc,GAAd,GAAoB,KAAKlB,CADlC;AAEA,yBAAO,EAAEF,GAAGgD,EAAL,EAAS9C,GAAG+C,EAAZ,EAAP;AACD,iBAbQ;AAcTC,2BAAW,qBAAW;AAAE,yBAAO,eAAe,KAAKlD,CAApB,GAAwB,GAAxB,GAA8B,KAAKE,CAAnC,GAAuC,GAA9C;AAAoD;AAdnE,eAAX;AAgBA,mBAAK+B,KAAL,CAAWM,IAAX,CAAgBV,IAAhB;AACA,qBAAOA,IAAP;AACD,aAhCI;AAiCLA,kBAAM,cAASY,EAAT,EAAa;AACjB,kBAAG,CAAC,KAAKU,GAAT,EAAc;AACZ,qBAAKC,OAAL,GAAe,EAAf;AACA,qBAAI,IAAIC,IAAE,CAAV,EAAaA,IAAI,KAAKpB,KAAL,CAAWY,MAA5B,EAAoCQ,GAApC,EAAyC;AACvC,sBAAIxB,OAAO,KAAKI,KAAL,CAAWoB,CAAX,CAAX;AACA,uBAAKD,OAAL,CAAavB,KAAKY,EAAlB,IAAwBZ,IAAxB;AACD;AACF;AACD,qBAAO,KAAKuB,OAAL,CAAaX,EAAb,CAAP;AACD,aA1CI;AA2CLH,kBAAM,cAASgB,GAAT,EAAcC,GAAd,EAAmB;AACvB,kBAAI7D,KAAK,KAAKmC,IAAL,CAAUyB,GAAV,CAAT;AAAA,kBACI3D,KAAK,KAAKkC,IAAL,CAAU0B,GAAV,CADT;AAEA,kBAAIC,OAAO/D,QAAQC,EAAR,EAAYC,EAAZ,CAAX;AACA,qBAAO6D,IAAP;AACD;AAhDI,WAAP;AAkDD;AACD,iBAASC,aAAT,CAAuBC,KAAvB,EAA8B;AAC5B,cAAIC,IAAI,IAAIzE,MAAM0E,QAAN,CAAeC,KAAnB,EAAR;AACAF,YAAEG,QAAF,CAAW,EAAX;AACAH,YAAEI,mBAAF,CAAsB,YAAW;AAAE,mBAAO,EAAP;AAAY,WAA/C;;AAEA,eAAI,IAAIV,IAAE,CAAV,EAAaA,IAAIK,MAAMzB,KAAN,CAAYY,MAA7B,EAAqCQ,GAArC,EAA0C;AACxC,gBAAIxC,IAAI6C,MAAMzB,KAAN,CAAYoB,CAAZ,CAAR;AACAM,cAAEK,OAAF,CAAUnD,EAAE4B,EAAZ,EAAgB;AACdC,qBAAO7B,EAAE6B,KADK;AAEdxB,qBAAOL,EAAEK,KAFK;AAGdE,sBAAQP,EAAEO;AAHI,aAAhB;AAKD;;AAED,eAAI,IAAIiC,IAAE,CAAV,EAAaA,IAAIK,MAAMxB,KAAN,CAAYW,MAA7B,EAAqCQ,GAArC,EAA0C;AACxC,gBAAIY,IAAIP,MAAMxB,KAAN,CAAYmB,CAAZ,CAAR;AACAM,cAAEO,OAAF,CAAUD,EAAE7B,MAAZ,EAAoB6B,EAAE5B,KAAtB;AACD;AACD,iBAAOsB,CAAP;AACD;AACD,iBAASQ,WAAT,CAAqBT,KAArB,EAA4B;AAC1B,cAAIC,IAAIF,cAAcC,KAAd,CAAR;AACAxE,gBAAMkF,MAAN,CAAaT,CAAb;;AAEA,eAAI,IAAIN,IAAE,CAAV,EAAaA,IAAIK,MAAMzB,KAAN,CAAYY,MAA7B,EAAqCQ,GAArC,EAA0C;AACxC,gBAAIgB,OAAOX,MAAMzB,KAAN,CAAYoB,CAAZ,CAAX;AACA,gBAAIZ,KAAK4B,KAAK5B,EAAd;AACA,gBAAI6B,MAAMX,EAAE9B,IAAF,CAAOY,EAAP,CAAV;AACA,gBAAG6B,GAAH,EAAQ;AACND,mBAAKrE,CAAL,GAASsE,IAAItE,CAAb;AACAqE,mBAAKnE,CAAL,GAASoE,IAAIpE,CAAb;AACD;AACF;;AAED,eAAI,IAAImD,IAAE,CAAV,EAAaA,IAAIK,MAAMxB,KAAN,CAAYW,MAA7B,EAAqCQ,GAArC,EAA0C;AACxC,gBAAIkB,OAAOb,MAAMxB,KAAN,CAAYmB,CAAZ,CAAX;AACA,gBAAIY,IAAI,EAAEO,GAAGD,KAAKnC,MAAV,EAAkBnB,GAAGsD,KAAKlC,KAA1B,EAAR;AACA,gBAAIoC,MAAMd,EAAErB,IAAF,CAAO2B,CAAP,CAAV;AACA,gBAAGQ,GAAH,EAAQ;AACNF,mBAAKG,MAAL,GAAcD,IAAIC,MAAlB;AACD;AACF;AACF;AACD,iBAASC,OAAT,CAAiBC,OAAjB,EAA0B;AACxBzF,aAAG0F,MAAH,CAAUD,QAAQnC,EAAlB,EACGqC,IADH,CACQ;AACJ5D,mBAAO0D,QAAQ1D,KADX;AAEJE,oBAAQwD,QAAQxD;AAFZ,WADR,EAKG2D,MALH,CAKU,MALV,EAMKA,MANL,CAMY,QANZ,EAOKD,IAPL,CAOU;AACJrC,gBAAI,OADA;AAEJuC,yBAAa,EAFT;AAGJC,0BAAc,EAHV;AAIJC,kBAAM,CAJF;AAKJC,kBAAM,CALF;AAMJC,oBAAQ,MANJ;AAOJC,yBAAa;AAPT,WAPV,EAgBON,MAhBP,CAgBc,MAhBd,EAiBOD,IAjBP,CAiBY;AACJzD,eAAG,kBADC;AAEJiE,kBAAM,MAFF;AAGJC,mBAAO;AAHH,WAjBZ;AAsBD;AACD,iBAASC,WAAT,CAAqBhB,CAArB,EAAwB;AACtB,cAAIiB,MAAM,CAAV;AACA,cAAIC,UAAU,MAAd;AACA,cAAIC,KAAJ;AACA,cAAGnB,EAAE3B,MAAF,GAAW4C,GAAd,EAAmB;AACjBE,oBAAQnB,CAAR;AACA,iBAAI,IAAInB,IAAEmB,EAAE3B,MAAZ,EAAoBQ,IAAIoC,GAAxB,EAA6BpC,GAA7B,EAAkC;AAChCsC,uBAASD,OAAT;AACD;AACF,WALD,MAKO,IAAGlB,EAAE3B,MAAF,GAAW4C,GAAd,EAAmB;AACxBE,oBAAQnB,EAAEoB,MAAF,CAAS,CAAT,EAAYH,GAAZ,CAAR;AACD,WAFM,MAEA;AACLE,oBAAQnB,CAAR;AACD;AACD,iBAAOmB,KAAP;AACD;AACD,iBAASE,SAAT,CAAmBlE,CAAnB,EAAsB;AACpB,cAAImE,MAAM,CAACnE,IAAI,GAAL,EAAUoE,OAAV,CAAkB,CAAlB,CAAV;AACA,cAAGD,IAAIjD,MAAJ,GAAa,CAAhB,EAAmB;AACjB,mBAAMiD,IAAIjD,MAAJ,GAAa,CAAnB,EAAsB;AACpBiD,oBAAM,SAAWA,GAAjB;AACD;AACF;AACD,iBAAOA,GAAP;AACD;AACD,iBAASE,cAAT,CAAwBC,IAAxB,EAA8B;AAC5B,cAAIR,MAAM,EAAV;AACA,cAAGQ,KAAKpD,MAAL,GAAc4C,GAAjB,EAAsB;AACpB,mBAAOQ,IAAP;AACD;AACD,iBAAOA,KAAKL,MAAL,CAAY,CAAZ,EAAeH,GAAf,CAAP;AACD;;AAED,iBAASS,YAAT,CAAsBxC,KAAtB,EAA6B;AAC3B,cAAIC,IAAID,MAAMA,KAAd;;AAEA,eAAI,IAAIL,IAAE,CAAV,EAAaA,IAAIM,EAAE1B,KAAF,CAAQY,MAAzB,EAAiCQ,GAAjC,EAAsC;AACpC,gBAAI8C,OAAOxC,EAAE1B,KAAF,CAAQoB,CAAR,CAAX;AACA,gBAAI+C,MAAM1C,MAAMzB,KAAN,CAAYoB,CAAZ,CAAV;AACA+C,gBAAIxD,KAAJ,GAAYuD,KAAKvD,KAAL,EAAZ;AACD;;AAED,eAAI,IAAIS,IAAE,CAAV,EAAaA,IAAIK,MAAMzB,KAAN,CAAYY,MAA7B,EAAqCQ,GAArC,EAA0C;AACxC,gBAAIxB,OAAO6B,MAAMzB,KAAN,CAAYoB,CAAZ,CAAX;AACA,iBAAI,IAAIgD,IAAE,CAAV,EAAaA,IAAIxE,KAAKc,MAAL,CAAYE,MAA7B,EAAqCwD,GAArC,EAA0C;AACxC,kBAAIV,QAAQ9D,KAAKc,MAAL,CAAY0D,CAAZ,CAAZ;AACA,kBAAIC,OAAOzE,KAAKe,KAAL,CAAWyD,CAAX,IAAgB,GAA3B;AACA,kBAAIE,WAAW,qBAAqB1E,KAAKY,EAA1B,GAA+B,iBAA/B,GAAmDkD,KAAnD,GAA2D,IAA1E;AACAxG,iBAAG0F,MAAH,CAAU0B,QAAV,EACKzB,IADL,CACU;AACF5D,uBAAOoF;AADL,eADV;;AAKAC,yBAAW,qBAAqB1E,KAAKY,EAA1B,GAA+B,kBAA/B,GAAoDkD,KAApD,GAA4D,IAAvE;AACAxG,iBAAG0F,MAAH,CAAU0B,QAAV,EACKC,IADL,CACUX,UAAUhE,KAAKe,KAAL,CAAWyD,CAAX,CAAV,CADV;AAED;AACF;AACF;;AAED,iBAASI,SAAT,CAAmB7B,OAAnB,EAA4B;AAC1B,cAAIlB,QAAQkB,QAAQlB,KAApB;AACA,cAAIgD,UAAU9B,QAAQ+B,OAAR,IAAmB,KAAjC;;AAEA,cAAI1E,QAAQ9C,GAAG0F,MAAH,CAAUD,QAAQnC,EAAlB,EACTmE,SADS,CACC,GADD,EAETC,IAFS,CAEJnD,MAAMzB,KAFF,EAGT6E,KAHS,GAIP/B,MAJO,CAIA,GAJA,EAKPD,IALO,CAKF;AACJrC,gBAAI,YAASpB,CAAT,EAAY;AAAE,qBAAOA,EAAEoB,EAAT;AAAc,aAD5B;AAEJsE,uBAAW,mBAAS1F,CAAT,EAAY;AAAE,qBAAOA,EAAE6B,SAAF,EAAP;AAAuB,aAF5C;AAGJqC,mBAAO;AAHH,WALE,EAUPyB,EAVO,CAUJ,WAVI,EAUS,UAAS3F,CAAT,EAAY;AAC3BlC,eAAGyH,SAAH,CAAa,cAAb,EAA6BK,IAA7B,CAAkC,UAASC,CAAT,EAAYC,CAAZ,EAAe;AAC/C,kBAAGD,EAAEzE,EAAF,KAASpB,EAAEoB,EAAd,EAAkB;AAChB,uBAAO,CAAC,CAAR;AACD,eAFD,MAEO;AACL,uBAAO,CAAP;AACD;AACF,aAND;AAOD,WAlBO,CAAZ;AAmBAR,gBAAM8C,MAAN,CAAa,MAAb,EACGD,IADH,CACQ;AACJ9E,eAAG,CADC;AAEJE,eAAG,CAFC;AAGJqF,mBAAO,YAHH;AAIJ6B,mBAAO,4BAJH;AAKJlG,mBAAO,eAASG,CAAT,EAAY;AAAE,qBAAOA,EAAEH,KAAT;AAAiB,aALlC;AAMJE,oBAAQ,gBAASC,CAAT,EAAY;AAAE,qBAAOA,EAAED,MAAT;AAAkB,aANpC;AAOJ,8BAAkB,SAPd;AAQJ,yBAAa,kBAASC,CAAT,EAAY;AAAE,qBAAOA,EAAEoB,EAAT;AAAc;AARrC,WADR;AAWAR,gBAAM8C,MAAN,CAAa,MAAb,EACGD,IADH,CACQ;AACJ9E,eAAG,WAASqB,CAAT,EAAY;AAAE,qBAAOA,EAAEH,KAAF,GAAU,CAAjB;AAAqB,aADlC;AAEJhB,eAAG,EAFC;AAGJoF,kBAAM,OAHF;AAIJC,mBAAO,WAJH;AAKJ,2BAAe,WALX;AAMJ,yBAAa;AANT,WADR,EASGiB,IATH,CASQ,UAASnF,CAAT,EAAY;AAAE,mBAAO2E,eAAe3E,EAAEoB,EAAjB,CAAP;AAA8B,WATpD,EAUG2E,KAVH,CAUS,aAVT,EAUwB,QAVxB;AAWAnF,gBAAMoF,IAAN,CAAW,UAAShG,CAAT,EAAY;AACrB,gBAAInB,IAAI,EAAR;AACA,iBAAI,IAAImD,IAAE,CAAV,EAAaA,IAAIhC,EAAEsB,MAAF,CAASE,MAA1B,EAAkCQ,GAAlC,EAAuC;AACrClE,iBAAG0F,MAAH,CAAU,IAAV,EACGE,MADH,CACU,MADV,EAEGD,IAFH,CAEQ;AACJ9E,mBAAG,CADC;AAEJE,mBAAGA,CAFC;AAGJqF,uBAAO,YAHH;AAIJ,+BAAe,WAJX;AAKJ,6BAAa,kBAASlE,CAAT,EAAY;AAAE,yBAAOA,EAAEoB,EAAT;AAAc,iBALrC;AAMJ,8BAAc,mBAASpB,CAAT,EAAY;AAAE,yBAAOA,EAAEsB,MAAF,CAASU,CAAT,CAAP;AAAqB;AAN7C,eAFR,EAUG2D,EAVH,CAUM,OAVN,EAUe,UAAS/C,CAAT,EAAY;AACvB,oBAAI9C,IAAI,IAAR;AACA,oBAAIsB,KAAKwB,EAAExB,EAAX;AACA,oBAAI+B,IAAIrD,EAAEmG,UAAF,CAAa,YAAb,EAA2B3B,KAAnC;AACA,oBAAIhC,IAAID,MAAMA,KAAd;AACA,oBAAI7B,OAAO8B,EAAE9B,IAAF,CAAOY,EAAP,CAAX;;AAEA,oBAAG8E,cAAc1F,KAAK2F,UAAnB,IAAiC,UAAU3F,KAAK2F,UAAnD,EAA+D;AAC7D7D,oBAAE8D,OAAF,CAAUhF,EAAV,EAAc+B,CAAd;AACD,iBAFD,MAEO;AACL,sBAAIkD,SAAS/D,EAAE9B,IAAF,CAAOY,EAAP,EAAWkF,UAAX,CAAsBnD,CAAtB,CAAb;AACA,sBAAIoD,SAASjE,EAAE9B,IAAF,CAAOY,EAAP,EAAWkD,KAAxB;AACA,sBAAG+B,WAAWE,MAAd,EAAsB;AACpBjE,sBAAEkE,SAAF,CAAYpF,EAAZ;AACD,mBAFD,MAEO;AACLkB,sBAAE8D,OAAF,CAAUhF,EAAV,EAAc+B,CAAd;AACD;AACF;;AAEDb,kBAAEmE,MAAF,CAASpB,OAAT,EACGqB,IADH,CACQ,UAAUC,CAAV,EAAa;AACjB9B,+BAAaxC,KAAb;AACD,iBAHH;AAID,eAjCH,EAkCG8C,IAlCH,CAkCQ,UAASnF,CAAT,EAAY;AAAE,uBAAOmE,YAAYnE,EAAEsB,MAAF,CAASU,CAAT,CAAZ,CAAP;AAAkC,eAlCxD;AAmCAnD,mBAAK,EAAL;AACD;AACF,WAxCD;AAyCA+B,gBAAMoF,IAAN,CAAW,UAAShG,CAAT,EAAY;AACrB,gBAAInB,IAAI,EAAR;AACA,iBAAK,IAAImD,IAAI,CAAb,EAAgBA,IAAIhC,EAAEuB,KAAF,CAAQC,MAA5B,EAAoCQ,GAApC,EAAyC;AACvClE,iBAAG0F,MAAH,CAAU,IAAV,EACGE,MADH,CACU,MADV,EAEGD,IAFH,CAEQ;AACJ9E,mBAAG,IAAIqB,EAAEH,KADL;AAEJhB,mBAAGA,CAFC;AAGJ,+BAAe,WAHX;AAIJqF,uBAAO,UAJH;AAKJ,6BAAa,kBAASlE,CAAT,EAAY;AAAE,yBAAOA,EAAEoB,EAAT;AAAc,iBALrC;AAMJ,+BAAe,oBAASpB,CAAT,EAAY;AAAE,yBAAOA,EAAEsB,MAAF,CAASU,CAAT,CAAP;AAAqB;AAN9C,eAFR,EAUGmD,IAVH,CAUQ,UAASnF,CAAT,EAAY;AAAE,uBAAOwE,UAAUxE,EAAEuB,KAAF,CAAQS,CAAR,CAAV,CAAP;AAA+B,eAVrD;AAWAnD,mBAAK,EAAL;AACD;AACF,WAhBD;AAiBA+B,gBAAMoF,IAAN,CAAW,UAAShG,CAAT,EAAY;AACrB,gBAAInB,IAAI,EAAR;AACA,iBAAK,IAAImD,IAAI,CAAb,EAAgBA,IAAIhC,EAAEuB,KAAF,CAAQC,MAA5B,EAAoCQ,GAApC,EAAyC;AACvClE,iBAAG0F,MAAH,CAAU,IAAV,EACGE,MADH,CACU,MADV,EAEGD,IAFH,CAEQ;AACJ9E,mBAAG,EADC;AAEJE,mBAAGA,CAFC;AAGJgB,uBAAOG,EAAEuB,KAAF,CAAQS,CAAR,IAAa,GAHhB;AAIJjC,wBAAQ,EAJJ;AAKJmE,uBAAO,UALH;AAMJ,6BAAa,kBAASlE,CAAT,EAAY;AAAE,yBAAOA,EAAEoB,EAAT;AAAc,iBANrC;AAOJ,8BAAc,mBAASpB,CAAT,EAAY;AAAE,yBAAOA,EAAEsB,MAAF,CAASU,CAAT,CAAP;AAAqB;AAP7C,eAFR;AAWAnD,mBAAK,EAAL;AACD;AACF,WAhBD;AAiBA+B,gBAAMoF,IAAN,CAAW,UAAShG,CAAT,EAAY;AACrB,gBAAIpB,KAAK,EAAT;AACA,gBAAIG,KAAKiB,EAAED,MAAF,GAAW,CAApB;AACA,gBAAIF,QAAQG,EAAEH,KAAF,GAAU,EAAtB;AACA,gBAAI+G,OAAO/G,QAAQ,GAAnB;AACA,gBAAIlB,IAAI,KAAKiI,IAAb;;AAEA,iBAAI,IAAI5E,IAAE,CAAV,EAAaA,IAAI,CAAjB,EAAoBA,GAApB,EAAyB;AACvBlE,iBAAG0F,MAAH,CAAU,IAAV,EACGE,MADH,CACU,MADV,EAEGD,IAFH,CAEQ;AACJ/E,oBAAIC,CADA;AAEJC,oBAAIA,EAFA;AAGJE,oBAAIH,CAHA;AAIJI,oBAAIA,EAJA;AAKJmF,uBAAO,aALH;AAMJ,oCAAoB,MANhB;AAOJ6B,uBAAO;AAPH,eAFR;AAWApH,mBAAKiI,IAAL;AACD;AACF,WArBD;;AAuBA,cAAIC,OAAO/I,GAAGgJ,QAAH,CAAYD,IAAZ,GACRE,MADQ,CACD,UAAS/G,CAAT,EAAY;AAClB,mBAAOA,CAAP;AACD,WAHQ,EAIR2F,EAJQ,CAIL,WAJK,EAIQ,UAAS/C,CAAT,EAAY;AAC3B9E,eAAGkJ,KAAH,CAASC,WAAT,CAAqBC,eAArB;AACD,WANQ,EAORvB,EAPQ,CAOL,MAPK,EAOG,UAAS/C,CAAT,EAAY;AACtBA,cAAEjE,CAAF,GAAMb,GAAGkJ,KAAH,CAASrI,CAAf;AACAiE,cAAE/D,CAAF,GAAMf,GAAGkJ,KAAH,CAASnI,CAAf;;AAEA,gBAAIuC,KAAK,OAAOwB,EAAExB,EAAlB;AACAtD,eAAG0F,MAAH,CAAUpC,EAAV,EAAcqC,IAAd,CAAmB,EAAEiC,WAAW9C,EAAEf,SAAF,EAAb,EAAnB;;AAEA,gBAAIsF,OAAO,sBAAsBvE,EAAExB,EAAxB,GAA6B,GAAxC;AACAtD,eAAGyH,SAAH,CAAa4B,IAAb,EACGnB,IADH,CACQ,UAAShG,CAAT,EAAY;AAChB,kBAAIqD,SAAShB,MAAMpB,IAAN,CAAWjB,EAAEe,MAAb,EAAqBf,EAAEgB,KAAvB,CAAb;AACAlD,iBAAG0F,MAAH,CAAU,IAAV,EAAgBC,IAAhB,CAAqB;AACnB/E,oBAAI2E,OAAO3E,EADQ;AAEnBE,oBAAIyE,OAAOzE,EAFQ;AAGnBE,oBAAIuE,OAAOvE,EAHQ;AAInBC,oBAAIsE,OAAOtE;AAJQ,eAArB;AAMD,aATH;;AAWAoI,mBAAO,qBAAqBvE,EAAExB,EAAvB,GAA4B,GAAnC;AACAtD,eAAGyH,SAAH,CAAa4B,IAAb,EACGnB,IADH,CACQ,UAAShG,CAAT,EAAY;AAChB,kBAAIqD,SAAShB,MAAMpB,IAAN,CAAWjB,EAAEe,MAAb,EAAqBf,EAAEgB,KAAvB,CAAb;AACAlD,iBAAG0F,MAAH,CAAU,IAAV,EAAgBC,IAAhB,CAAqB;AACnB/E,oBAAI2E,OAAO3E,EADQ;AAEnBE,oBAAIyE,OAAOzE,EAFQ;AAGnBE,oBAAIuE,OAAOvE,EAHQ;AAInBC,oBAAIsE,OAAOtE;AAJQ,eAArB;AAMD,aATH;AAUD,WArCQ,CAAX;AAsCA6B,gBAAMwG,IAAN,CAAWP,IAAX;AACD;AACD,iBAASQ,SAAT,CAAmB9D,OAAnB,EAA4B;AAC1B,cAAIlB,QAAQkB,QAAQlB,KAApB;AACA,cAAIxB,QAAQ/C,GAAG0F,MAAH,CAAUD,QAAQnC,EAAlB,EACTmE,SADS,CACC,MADD,EAETC,IAFS,CAEJnD,MAAMxB,KAFF,EAGT4E,KAHS,GAIP/B,MAJO,CAIA,MAJA,EAKPsC,IALO,CAKF,UAAShG,CAAT,EAAY;AAChB,gBAAIqD,SAAShB,MAAMpB,IAAN,CAAWjB,EAAEe,MAAb,EAAqBf,EAAEgB,KAAvB,CAAb;AACAlD,eAAG0F,MAAH,CAAU,IAAV,EAAgBC,IAAhB,CAAqB;AACnB,6BAAezD,EAAEe,MADE;AAEnB,4BAAcf,EAAEgB,KAFG;AAGnBtC,kBAAI2E,OAAO3E,EAHQ;AAInBE,kBAAIyE,OAAOzE,EAJQ;AAKnBE,kBAAIuE,OAAOvE,EALQ;AAMnBC,kBAAIsE,OAAOtE,EANQ;AAOnBgH,qBAAO,oCAPY;AAQnB7B,qBAAO,WARY;AASnB,4BAAc;AATK,aAArB;AAWD,WAlBO,CAAZ;AAmBD;AACD,iBAASoD,SAAT,CAAmB/D,OAAnB,EAA4B;AAC1BD,kBAAQC,OAAR;AACAT,sBAAYS,QAAQlB,KAApB;AACAgF,oBAAU9D,OAAV;AACA6B,oBAAU7B,OAAV;AACD;AACD,iBAASgE,WAAT,CAAqBhE,OAArB,EAA8B;AAC5B8D,oBAAU9D,OAAV;AACA6B,oBAAU7B,OAAV;AACD;AACD,iBAASiE,SAAT,CAAmBC,SAAnB,EAA8B;AAC5B,cAAIC,MAAM,CAAV;AACA,cAAInG,QAAQ,EAAZ;AACA,eAAI,IAAIS,IAAE,CAAV,EAAaA,IAAIyF,UAAUjG,MAA3B,EAAmCQ,GAAnC,EAAwC;AACtC0F,mBAAOD,UAAUzF,CAAV,CAAP;AACAT,kBAAML,IAAN,CAAWuG,UAAUzF,CAAV,CAAX;AACD;AACD,eAAI,IAAIA,IAAE,CAAV,EAAaA,IAAIyF,UAAUjG,MAA3B,EAAmCQ,GAAnC,EAAwC;AACtCT,kBAAMS,CAAN,IAAWT,MAAMS,CAAN,IAAW0F,GAAtB;AACD;AACD,iBAAOnG,KAAP;AACD;AACD,iBAASoG,YAAT,CAAsBnC,IAAtB,EAA4BoC,QAA5B,EAAsC;AACpC,cAAIC,OAAOC,SAASC,aAAT,CAAuB,GAAvB,CAAX;AACAF,eAAKG,IAAL,GAAYxC,IAAZ;AACAqC,eAAKI,QAAL,GAAgBL,QAAhB;;AAEAE,mBAASI,IAAT,CAAcC,WAAd,CAA0BN,IAA1B;AACAA,eAAKO,KAAL;AACAN,mBAASI,IAAT,CAAcG,WAAd,CAA0BR,IAA1B;AACD;AACD,iBAASS,SAAT,GAAqB;AACnB,cAAIC,MAAM,EAAV;;AAEAA,cAAIC,SAAJ,GAAgB,UAASnG,KAAT,EAAgB;AAC9B,gBAAIC,IAAI3B,UAAR;;AAEA,iBAAI,IAAIqB,IAAE,CAAV,EAAaA,IAAIK,MAAMzB,KAAN,CAAYY,MAA7B,EAAqCQ,GAArC,EAA0C;AACxC,kBAAIxC,IAAI6C,MAAMzB,KAAN,CAAYoB,CAAZ,CAAR;AACAM,gBAAEnB,OAAF,CAAU3B,EAAEoF,IAAZ,EAAkBpF,EAAEoF,IAApB,EAA0BpF,EAAE8B,MAA5B,EAAoCkG,UAAUhI,EAAEiI,SAAZ,CAApC;AACA,mBAAI,IAAIzC,IAAE,CAAV,EAAaA,IAAIxF,EAAEiJ,OAAF,CAAUjH,MAA3B,EAAmCwD,GAAnC,EAAwC;AACtC,oBAAI1E,IAAId,EAAEiJ,OAAF,CAAUzD,CAAV,CAAR;AACA1C,kBAAExB,OAAF,CAAUR,EAAEsE,IAAZ,EAAkBpF,EAAEoF,IAApB;AACD;AACF;;AAEDtC,cAAED,KAAF,GAAUA,KAAV;AACA,mBAAOC,CAAP;AACD,WAdD;;AAgBAiG,cAAIG,IAAJ,GAAW,UAASnF,OAAT,EAAkB;AAC3B+D,sBAAU/D,OAAV;AACD,WAFD;;AAIAgF,cAAII,MAAJ,GAAa,UAASpF,OAAT,EAAkB;AAC7BgE,wBAAYhE,OAAZ;AACD,WAFD;;AAIAgF,cAAIK,WAAJ,GAAkB,UAASrF,OAAT,EAAkB;AAClCsB,yBAAatB,QAAQlB,KAArB;AACD,WAFD;;AAIAkG,cAAIM,eAAJ,GAAsB,UAASxG,KAAT,EAAgByG,MAAhB,EAAwBvF,OAAxB,EAAiC;AACrD,gBAAIiC,IAAJ,EAAUoC,QAAV;AACA,gBAAGkB,MAAH,EAAW;AACT,kBAAIxD,UAAUjD,MAAMA,KAAN,CAAYiD,OAA1B;AACAE,qBAAO,kCAAgCuD,mBAAmBC,KAAKC,SAAL,CAAe3D,OAAf,CAAnB,CAAvC;AACAsC,yBAAW,UAAUsB,KAAKC,GAAL,EAAV,GAAuB,OAAlC;AACD,aAJD,MAIO;AACL,kBAAIC,MAAM/G,MAAMA,KAAN,CAAYgH,YAAZ,CAAyB9F,OAAzB,CAAV;AACAiC,qBAAO,iCAAiCuD,mBAAmBK,GAAnB,CAAxC;AACAxB,yBAAW,UAAUsB,KAAKC,GAAL,EAAV,GAAuB,MAAlC;AACD;AACDxB,yBAAanC,IAAb,EAAmBoC,QAAnB;AACD,WAZD;;AAcA,iBAAOW,GAAP;AACD;;AAED,YAAG,QAAOe,MAAP,yCAAOA,MAAP,OAAkB,QAAlB,IAA8BA,MAA9B,IAAwC,QAAOA,OAAOC,OAAd,MAA0B,QAArE,EAA+E;AAC7E1L,kBAAQ2L,QAAQ,OAAR,CAAR;AACA1L,eAAK0L,QAAQ,IAAR,CAAL;AACAzL,oBAAUyL,QAAQ,SAAR,CAAV;AACAF,iBAAOC,OAAP,GAAiBjB,WAAjB;AACD,SALD,MAKO;AACL,cAAG,OAAOmB,UAAP,KAAuB,WAA1B,EAAuC;AACrC5L,oBAAQD,OAAOC,KAAf;AACAC,iBAAKF,OAAOE,EAAZ;AACAC,sBAAUH,OAAOG,OAAjB;AACAH,mBAAO6L,UAAP,GAAoBnB,WAApB;AACD;;AAED,cAAG,OAAOoB,MAAP,KAAkB,UAAlB,IAAgCA,OAAOC,GAA1C,EAA+C;AAC7CD,mBAAO,YAAP,EAAqB,EAArB,EAAyBpB,WAAzB;AACD;AACF;AACF,OAzjBD","file":"jsbayes-viz.js","sourcesContent":["(function(window) {\n  'use strict';\n  var dagre;\n  var d3;\n  var jsbayes;\n  var OUT_LEFT = 1,\n      OUT_TOP = 2,\n      OUT_RIGHT = 4,\n      OUT_BOTTOM = 8;\n\n  function getPath(n1, n2) {\n    var c1 = center(n1),\n        c2 = center(n2);\n    var x1 = c1.x,\n        y1 = c1.y,\n        x2 = c2.x,\n        y2 = c2.y,\n        theta = Math.atan2(y2 - y1, x2 - x1);\n    var p1 = getPoint(theta, n1),\n        p2 = getPoint(theta + Math.PI, n2);\n    if(p1.error || p2.error) {\n      return {x1: 0, y1: 0, x2: 0, y2: 0, error: true };\n    }\n    return { x1: p1.x, y1: p1.y, x2: p2.x, y2: p2.y };\n  }\n  function getPoint(theta, n) {\n    var c = center(n);\n    var cx = c.x;\n    var cy = c.y;\n    var w = n.width / 2.0;\n    var h = n.height / 2.0;\n    var d = distance(cx, cy, cx+w, cy+h);\n    var x = cx + d * Math.cos(theta);\n    var y = cy + d * Math.sin(theta);\n    var ocode = outcode(n, x, y);\n    var p = { };\n    switch(ocode) {\n      case OUT_TOP:\n        p.x = cx - h*((x-cx)/(y-cy));\n        p.y = cy - h;\n        break;\n      case OUT_LEFT:\n        p.x = cx - w;\n        p.y = cy - w*((y-cy)/(x-cx));\n        break;\n      case OUT_BOTTOM:\n        p.x = cx + h*((x-cx)/(y-cy));\n        p.y = cy + h;\n        break;\n      case OUT_RIGHT:\n        p.x = cx + w;\n        p.y = cy + w*((y-cy)/(x-cx));\n        break;\n      default:\n        console.error('non-cardinal outcode ' + ocode);\n        p.error = true;\n    }\n    return p;\n  }\n  function center(node) {\n    var x = node.width / 2.0 + node.x,\n        y = node.height / 2.0 + node.y;\n    return { x: x, y: y };\n  }\n  function distance(x1, y1, x2, y2) {\n    var x = x1 - x2;\n    var y = y1 - y2;\n    var d = Math.sqrt(x*x + y*y);\n    return d;\n  }\n  function outcode(n, x, y) {\n    var out = 0;\n    if(n.width <= 0) {\n      out |= OUT_LEFT | OUT_RIGHT;\n    } else if(x < n.x) {\n      out |= OUT_LEFT;\n    } else if(x > n.x + n.width) {\n      out |= OUT_RIGHT;\n    }\n\n    if(n.height <= 0) {\n      out |= OUT_TOP | OUT_BOTTOM;\n    } else if(y < n.y) {\n      out |= OUT_TOP;\n    } else if(y > n.y + n.height) {\n      out |= OUT_BOTTOM;\n    }\n    return out;\n  }\n  function newGraph() {\n    return {\n      nodes: [],\n      edges: [],\n      addEdge: function(parent, child) {\n        var edge = {\n          parent: parent,\n          child: child\n        };\n        this.edges.push(edge);\n        return edge;\n      },\n      addNode: function(id, label, values, probs) {\n        var width = 150;\n        var height = values.length * 15 + 20; \n        var node = {\n          id: id,\n          label: label,\n          values: values,\n          probs: probs,\n          width: width,\n          height: height,\n          x: Math.random(),\n          y: Math.random(),\n          mid: function() {\n            var dx = this.width / 2.0 + this.x,\n                dy = this.height / 2.0 + this.y;\n            return { x: dx, y: dy };\n          },\n          translate: function() { return 'translate(' + this.x + ',' + this.y + ')'; }\n        };\n        this.nodes.push(node);\n        return node;\n      },\n      node: function(id) {\n        if(!this.map) {\n          this.nodeMap = {};\n          for(var i=0; i < this.nodes.length; i++) {\n            var node = this.nodes[i];\n            this.nodeMap[node.id] = node;\n          }\n        }\n        return this.nodeMap[id];\n      },\n      edge: function(id1, id2) {\n        var n1 = this.node(id1),\n            n2 = this.node(id2);\n        var path = getPath(n1, n2);\n        return path;\n      }\n    };\n  }\n  function getDagreGraph(graph) {\n    var g = new dagre.graphlib.Graph();\n    g.setGraph({});\n    g.setDefaultEdgeLabel(function() { return {}; });\n\n    for(var i=0; i < graph.nodes.length; i++) {\n      var n = graph.nodes[i];\n      g.setNode(n.id, {\n        label: n.label,\n        width: n.width,\n        height: n.height\n      });\n    }\n\n    for(var i=0; i < graph.edges.length; i++) {\n      var e = graph.edges[i];\n      g.setEdge(e.parent, e.child);\n    }\n    return g;\n  }\n  function layoutGraph(graph) {\n    var g = getDagreGraph(graph);\n    dagre.layout(g);\n\n    for(var i=0; i < graph.nodes.length; i++) {\n      var gout = graph.nodes[i];\n      var id = gout.id;\n      var gin = g.node(id);\n      if(gin) {\n        gout.x = gin.x;\n        gout.y = gin.y;\n      }\n    }\n\n    for(var i=0; i < graph.edges.length; i++) {\n      var eout = graph.edges[i];\n      var e = { v: eout.parent, w: eout.child };\n      var ein = g.edge(e);\n      if(ein) {\n        eout.points = ein.points;\n      }\n    }\n  }\n  function initSvg(options) {\n    d3.select(options.id)\n      .attr({\n        width: options.width,\n        height: options.height\n      })\n      .append('defs')\n        .append('marker')\n        .attr({\n          id: 'arrow',\n          markerWidth: 10,\n          markerHeight: 10,\n          refX: 5,\n          refY: 3,\n          orient: 'auto',\n          markerUnits: 'strokeWidth'\n        })\n          .append('path')\n          .attr({\n            d: 'M0,0 L0,6 L5,3 z',\n            fill: '#f00',\n            class: 'edge-head'\n          });\n  }\n  function formatValue(v) {\n    var MAX = 5;\n    var subchar = '\\u00A0';\n    var value;\n    if(v.length < MAX) {\n      value = v;\n      for(var i=v.length; i < MAX; i++) {\n        value += subchar;\n      }\n    } else if(v.length > MAX) {\n      value = v.substr(0, MAX);\n    } else {\n      value = v;\n    }\n    return value;\n  }\n  function formatPct(p) {\n    var pct = (p * 100).toFixed(2);\n    if(pct.length < 6) {\n      while(pct.length < 6) {\n        pct = '\\u00A0' + pct;\n      }\n    }\n    return pct;\n  }\n  function formatNodeName(name) {\n    var MAX = 15;\n    if(name.length < MAX) {\n      return name;\n    }\n    return name.substr(0, MAX);\n  }\n\n  function drawNodeBars(graph) {\n    var g = graph.graph;\n\n    for(var i=0; i < g.nodes.length; i++) {\n      var nOut = g.nodes[i];\n      var nIn = graph.nodes[i];\n      nIn.probs = nOut.probs();\n    }\n\n    for(var i=0; i < graph.nodes.length; i++) {\n      var node = graph.nodes[i];\n      for(var j=0; j < node.values.length; j++) {\n        var value = node.values[j];\n        var prob = node.probs[j] * 100;\n        var selector = 'rect[data-node=\"' + node.id + '\"][data-value=\"' + value + '\"]';\n        d3.select(selector)\n            .attr({\n                width: prob\n            });\n\n        selector = 'text[data-node=\"' + node.id + '\"][data-pvalue=\"' + value + '\"]';\n        d3.select(selector)\n            .text(formatPct(node.probs[j]));\n      }\n    }\n  }\n\n  function drawNodes(options) {\n    var graph = options.graph;\n    var SAMPLES = options.samples || 10000;\n    \n    var nodes = d3.select(options.id)\n      .selectAll('g')\n      .data(graph.nodes)\n      .enter()\n        .append('g')\n        .attr({\n          id: function(d) { return d.id; },\n          transform: function(d) { return d.translate(); },\n          class: 'node-group'\n        })\n        .on('mousedown', function(d) { \n          d3.selectAll('g.node-group').sort(function(a, b) {\n            if(a.id !== d.id) {\n              return -1;\n            } else {\n              return 1;\n            }\n          });\n        });\n    nodes.append('rect')\n      .attr({\n        x: 0,\n        y: 0,\n        class: 'node-shape',\n        style: 'stroke:#000000; fill:none;',\n        width: function(d) { return d.width; },\n        height: function(d) { return d.height; },\n        'pointer-events': 'visible',\n        'data-node': function(d) { return d.id; }\n      });\n    nodes.append('text')\n      .attr({\n        x: function(d) { return d.width / 2; },\n        y: 15,\n        fill: 'black',\n        class: 'node-name',\n        'font-family': 'monospace',\n        'font-size': 15\n      })\n      .text(function(d) { return formatNodeName(d.id); })\n      .style('text-anchor', 'middle');\n    nodes.each(function(d) {\n      var y = 30;\n      for(var i=0; i < d.values.length; i++) {\n        d3.select(this)\n          .append('text')\n          .attr({\n            x: 2,\n            y: y,\n            class: 'node-value',\n            'font-family': 'monospace',\n            'data-node': function(d) { return d.id; },\n            'data-value': function(d) { return d.values[i]; }\n          })\n          .on('click', function(e) {\n            var h = this;\n            var id = e.id;\n            var v = h.attributes['data-value'].value;\n            var g = graph.graph;\n            var node = g.node(id);\n          \n            if(undefined === node.isObserved || false === node.isObserved) {\n              g.observe(id, v);\n            } else {\n              var index1 = g.node(id).valueIndex(v);\n              var index2 = g.node(id).value;\n              if(index1 === index2) {\n                g.unobserve(id);\n              } else {\n                g.observe(id, v);\n              }\n            }\n\n            g.sample(SAMPLES)\n              .then(function (r) {\n                drawNodeBars(graph);\n              });\n          })\n          .text(function(d) { return formatValue(d.values[i]); });\n        y += 15;\n      }\n    });\n    nodes.each(function(d) {\n      var y = 30;\n      for (var i = 0; i < d.probs.length; i++) {\n        d3.select(this)\n          .append('text')\n          .attr({\n            x: 2 + d.width,\n            y: y,\n            'font-family': 'monospace',\n            class: 'node-pct',\n            'data-node': function(d) { return d.id; },\n            'data-pvalue': function(d) { return d.values[i]; }\n          })\n          .text(function(d) { return formatPct(d.probs[i]); });\n        y += 15;\n      }\n    });\n    nodes.each(function(d) {\n      var y = 20;\n      for (var i = 0; i < d.probs.length; i++) {\n        d3.select(this)\n          .append('rect')\n          .attr({\n            x: 50,\n            y: y,\n            width: d.probs[i] * 100,\n            height: 10,\n            class: 'node-bar',\n            'data-node': function(d) { return d.id; },\n            'data-value': function(d) { return d.values[i]; }\n          });\n        y += 15;\n      }\n    });\n    nodes.each(function(d) {\n      var y1 = 20;\n      var y2 = d.height - 5;\n      var width = d.width - 50;\n      var xInc = width / 4.0;\n      var x = 50 + xInc;\n      \n      for(var i=0; i < 3; i++) {\n        d3.select(this)\n          .append('line')\n          .attr({\n            x1: x,\n            y1: y1,\n            x2: x,\n            y2: y2,\n            class: 'node-iqline',\n            'stroke-dasharray': '5, 1',\n            style: 'stroke:black; stroke-width:1px',\n          });\n        x += xInc;\n      }\n    });\n\n    var drag = d3.behavior.drag()\n      .origin(function(d) {\n        return d;\n      })\n      .on('dragstart', function(e) {\n        d3.event.sourceEvent.stopPropagation();\n      })\n      .on('drag', function(e) {\n        e.x = d3.event.x;\n        e.y = d3.event.y;\n\n        var id = 'g#' + e.id;\n        d3.select(id).attr({ transform: e.translate() });\n\n        var arcs = 'line[data-parent=' + e.id + ']';\n        d3.selectAll(arcs)\n          .each(function(d) {\n            var points = graph.edge(d.parent, d.child);\n            d3.select(this).attr({\n              x1: points.x1,\n              y1: points.y1,\n              x2: points.x2,\n              y2: points.y2\n            });\n          });\n\n        arcs = 'line[data-child=' + e.id + ']';\n        d3.selectAll(arcs)\n          .each(function(d) {\n            var points = graph.edge(d.parent, d.child);\n            d3.select(this).attr({\n              x1: points.x1,\n              y1: points.y1,\n              x2: points.x2,\n              y2: points.y2\n            });\n          });\n      });\n    nodes.call(drag);\n  }\n  function drawEdges(options) {\n    var graph = options.graph;\n    var edges = d3.select(options.id)\n      .selectAll('line')\n      .data(graph.edges)\n      .enter()\n        .append('line')\n        .each(function(d) {\n          var points = graph.edge(d.parent, d.child);\n          d3.select(this).attr({\n            'data-parent': d.parent,\n            'data-child': d.child,\n            x1: points.x1,\n            y1: points.y1,\n            x2: points.x2,\n            y2: points.y2,\n            style: 'stroke:rgb(255,0,0);stroke-width:2',\n            class: 'edge-line',\n            'marker-end': 'url(#arrow)'\n          });\n        });\n  }\n  function drawGraph(options) {\n    initSvg(options);\n    layoutGraph(options.graph);\n    drawEdges(options);\n    drawNodes(options);\n  }\n  function redrawGraph(options) {\n    drawEdges(options);\n    drawNodes(options);\n  }\n  function normalize(sampledLw) {\n    var sum = 0;\n    var probs = [];\n    for(var i=0; i < sampledLw.length; i++) {\n      sum += sampledLw[i];\n      probs.push(sampledLw[i]);\n    }\n    for(var i=0; i < sampledLw.length; i++) {\n      probs[i] = probs[i] / sum;\n    }\n    return probs;\n  }\n  function downloadData(data, filename) {\n    var link = document.createElement('a');\n    link.href = data;\n    link.download = filename;\n\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n  }\n  function defineLib() {\n    var lib = {};\n\n    lib.fromGraph = function(graph) {\n      var g = newGraph();\n\n      for(var i=0; i < graph.nodes.length; i++) {\n        var n = graph.nodes[i];\n        g.addNode(n.name, n.name, n.values, normalize(n.sampledLw));\n        for(var j=0; j < n.parents.length; j++) {\n          var p = n.parents[j];\n          g.addEdge(p.name, n.name);\n        }\n      }\n\n      g.graph = graph;\n      return g;\n    }\n\n    lib.draw = function(options) {\n      drawGraph(options);\n    }\n\n    lib.redraw = function(options) {\n      redrawGraph(options);\n    }\n\n    lib.redrawProbs = function(options) {\n      drawNodeBars(options.graph);\n    }\n    \n    lib.downloadSamples = function(graph, asJson, options) {\n      var data, filename;\n      if(asJson) {\n        var samples = graph.graph.samples;\n        data = 'data:text/json;charset=utf-8,'+encodeURIComponent(JSON.stringify(samples));\n        filename = 'data-' + Date.now() + '.json';\n      } else {\n        var csv = graph.graph.samplesAsCsv(options);\n        data = 'data:text/csv;charset=utf-8,' + encodeURIComponent(csv);\n        filename = 'data-' + Date.now() + '.csv';\n      }\n      downloadData(data, filename);\n    }\n    \n    return lib;\n  }\n\n  if(typeof module === 'object' && module && typeof module.exports === 'object') {\n    dagre = require('dagre');\n    d3 = require('d3');\n    jsbayes = require('jsbayes');\n    module.exports = defineLib();\n  } else {\n    if(typeof(jsbayesviz) === 'undefined') {\n      dagre = window.dagre;\n      d3 = window.d3;\n      jsbayes = window.jsbayes;\n      window.jsbayesviz = defineLib();\n    }\n\n    if(typeof define === 'function' && define.amd) {\n      define('jsbayesviz', [], defineLib());\n    }\n  }\n})(this);"]}