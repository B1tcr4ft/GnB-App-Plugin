{"version":3,"sources":["../../src/lib/jsbayes.js"],"names":["window","initCpt","numValues","cpt","sum","i","Math","random","initCptWithParents","values","parents","paIndex","length","idx","numPaVals","cpts","push","async","f","args","Promise","resolve","reject","r","apply","undefined","e","isArray","o","constructor","Array","isArrayOfArray","setNodeCptProbs","probs","index","nextIndex","next","initNodeCpt","normalizeProbs","arr","normalizeCpts","defineLib","jsbayes","newGraph","nodes","saveSamples","samples","reinit","g","node","dirty","samplesAsCsv","options","opts","D_ROW","rowDelimiter","D_FIELD","fieldDelimiter","csv","row","name","sample","j","h","initSampleLw","lwSum","count","n","isObserved","value","wasSampled","fa","sampleLw","saveSampleLw","update","m","tnode","unode","sampledLw","nodeMap","observe","valueIndex","console","error","unobserve","addNode","addParent","parent","v","valueIndexMap","pa","pSampleLw","dh","p","fv","setCpt","s","toMessage","pas","msg","JSON","stringify","module","exports","define","amd"],"mappings":"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","file":"jsbayes.js","sourcesContent":["(function(window) {\n  'use strict';\n\n  /**\n   * Initializes a conditional probability table.\n   * @param {Number} numValues Number of values.\n   * @returns {Array} Array of doubles that sum to 1.0.\n   */\n  function initCpt(numValues) {\n    var cpt = [];\n    var sum = 0;\n    for(var i=0; i < numValues; i++) {\n      cpt[i] = Math.random();\n      sum += cpt[i];\n    }\n    for(var i=0; i < numValues; i++) {\n      cpt[i] = cpt[i] / sum;\n    }\n    return cpt;\n  }\n\n  /**\n   * Initializes a CPT with fake and normalized values using recursion.\n   * @param {Array} values Values of variables (array of values).\n   * @param {Array} parents Array of JSON nodes that are parents of the variable.\n   * @param {Number} paIndex The current parent index.\n   * @returns {Array} An array of nested arrays representing the CPT.\n   */\n  function initCptWithParents(values, parents, paIndex) {\n    if(parents && parents.length > 0) {\n      if(parents.length === 1 || paIndex === parents.length - 1) {\n        var idx = parents.length === 1 ? 0 : paIndex;\n        var numPaVals = parents[idx].values.length;\n        var cpts = [];\n        for(var i=0; i < numPaVals; i++) {\n          var cpt = initCpt(values.length);\n          cpts.push(cpt);\n        }\n        return cpts;\n      } else {\n        var cpts = [];\n        var numPaVals = parents[paIndex].values.length;\n        for(var i=0; i < numPaVals; i++) {\n          var cpt = initCptWithParents(values, parents, paIndex+1);\n          cpts.push(cpt);\n        }\n        return cpts;\n      }\n    } else {\n      return initCpt(values.length);\n    }\n  }\n\n  /**\n   * Creates a Promise.\n   * @param {Object} f Function.\n   * @param {Array} args List of arguments.\n   * @returns {Promise} Promise.\n   */\n  function async(f, args) {\n    return new Promise(\n      function(resolve, reject) {\n        try {\n          var r = f.apply(undefined, args);\n          resolve(r);\n        } catch(e) {\n          reject(e);\n        }\n      }\n    );\n  }\n\n  /**\n   * Checks if an object is an array.\n   * @param {*} o Object.\n   * @returns {Boolean} A boolean to indicate if the object is an array object.\n   */\n  function isArray(o) {\n    return (o.constructor === Array);\n  }\n\n  /**\n   * Checks if an object is an array of arrays.\n   * @param {*} o Object.\n   * @returns {Boolean} A boolean to indicate if the object is array of arrays.\n   */\n  function isArrayOfArray(o) {\n    if(isArray(o)) {\n      if(o.length > 0) {\n        if(isArray(o[0])) {\n          return true;\n        }\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Sets the CPT entries to the specified probabilities.\n   * @param {Array} cpt Array of nested arrays representing a CPT.\n   * @param {Array} probs Array of arrays of probabilities representing a CPT.\n   * @param {Number} index The current index.\n   * @returns {Number} The next index.\n   */\n  function setNodeCptProbs(cpt, probs, index) {\n    if(!isArrayOfArray(cpt)) {\n      for(var i=0; i < cpt.length; i++) {\n        cpt[i] = probs[index][i];\n      }\n      var nextIndex = index + 1;\n      return nextIndex;\n    } else {\n      var next = index;\n      for(var i=0; i < cpt.length; i++) {\n        next = setNodeCptProbs(cpt[i], probs, next);\n      }\n      return next;\n    }\n  }\n\n  /**\n   * Initializes a node's CPT.\n   * @param {Array} values Array of values.\n   * @param {Array} parents Array of parents.\n   * @param {Array} probs Array of arrays of probabilities.\n   * @returns {Array} Array of nested arrays representing a CPT.\n   */\n  function initNodeCpt(values, parents, probs) {\n    var cpt = initCptWithParents(values, parents, 0);\n    setNodeCptProbs(cpt, probs, 0);\n    return cpt;\n  }\n\n  /**\n   * Normalizes an array of values such that the elements sum to 1.0. Note that\n   * 0.001 is added to every value to avoid 0.0 probabilities. This adjustment\n   * helps with visualization downstream.\n   * @param {Array} arr Array of probabilities.\n   * @returns {Array} Normalized probailities.\n   */\n  function normalizeProbs(arr) {\n    var probs = [];\n    var sum = 0.0;\n    for (var i=0; i < arr.length; i++) {\n      probs[i] = arr[i] + 0.001\n      sum += probs[i]\n    }\n    for (var i=0; i < arr.length; i++) {\n      probs[i] = probs[i] / sum;\n    }\n    return probs;\n  }\n\n  /**\n   * Normalizes a CPT.\n   * @param {Array} cpts Array of arrays (matrix) representing a CPT.\n   * @returns {Array} Normalized CPT.\n   */\n  function normalizeCpts(cpts) {\n    var probs = []\n    for (var i=0; i < cpts.length; i++) {\n      probs.push(normalizeProbs(cpts[i]));\n    }\n    return probs;\n  }\n\n  /**\n   * Defines the library.\n   */\n  function defineLib() {\n    var jsbayes = {};\n    jsbayes.newGraph = function() {\n      return {\n        nodes: [],\n        saveSamples: false,\n        samples: [],\n        reinit: function() {\n          var f = function(g) {\n            for(var i=0; i < g.nodes.length; i++) {\n              var node = g.nodes[i];\n              if(node.dirty === undefined || node.dirty) {\n                node.cpt = initCptWithParents(node.values, node.parents, 0);\n                node.dirty = false;\n              }\n            }\n          };\n          return async(f, [this]);\n        },\n        samplesAsCsv: function(options) {\n          var opts = options || {};\n          var D_ROW = opts.rowDelimiter || '\\n';\n          var D_FIELD = opts.fieldDelimiter || ',';\n          var csv = '';\n          var row = '';\n          for(var i=0; i < this.nodes.length; i++) {\n            row += this.nodes[i].name;\n            if(i < this.nodes.length-1) {\n              row += D_FIELD;\n            }\n          }\n          csv += row + D_ROW;\n\n          for(var i=0; i < this.samples.length; i++) {\n            var sample = this.samples[i];\n            row = '';\n            for(var j=0; j < this.nodes.length; j++) {\n              var node = this.nodes[j];\n              row += sample[node.name];\n              if(j < this.nodes.length-1) {\n                row += D_FIELD;\n              }\n            }\n            csv += row;\n            if(i < this.samples.length-1) {\n              csv += D_ROW;\n            }\n          }\n          \n          return csv;\n        },\n        sample: function(samples) {\n          var f = function(g, samples) {\n            if(g.saveSamples) {\n              //reset the samples if we want to save them\n              g.samples = [];\n            }\n            \n            for(var h=g.nodes.length-1; h >= 0; h--) {\n              g.nodes[h].initSampleLw();\n            }\n\n            var lwSum = 0;\n            for(var count=0; count < samples; count++) {\n              for(var h=g.nodes.length-1; h >= 0; h--) {\n                var n = g.nodes[h];\n                if(!n.isObserved) {\n                  n.value = -1;\n                }\n                n.wasSampled = false;\n              }\n\n              var fa = 1;\n              for(var h=g.nodes.length-1; h >= 0; h--) {\n                var n = g.nodes[h];\n                fa *= n.sampleLw();\n              }\n              lwSum += fa;\n              for(var h=g.nodes.length-1; h >= 0; h--) {\n                var n = g.nodes[h];\n                n.saveSampleLw(fa);\n              }\n              \n              if(g.saveSamples) {\n                var sample = {};\n                for(var h=g.nodes.length-1; h >= 0; h--) {\n                  var n = g.nodes[h];\n                  sample[n.name] = n.values[n.value];\n                }\n                g.samples.push(sample);\n              }\n            }\n\n            return lwSum;\n          };\n          return async(f, [this, samples]);\n        },\n        update: function(m) {\n          for(var i=0; i < this.nodes.length; i++) {\n            var tnode = this.nodes[i]; //'this' node\n            var unode = m[tnode.name]; //update node\n\n            if(!unode) {\n              continue;\n            }\n\n            tnode.value = unode.value;\n            tnode.wasSampled = unode.wasSampled;\n            tnode.sampledLw = unode.sampledLw;\n          }\n        },\n        node: function(name) {\n          if(!this.nodeMap) {\n            this.nodeMap = {};\n            for(var i=0; i < this.nodes.length; i++) {\n              var node = this.nodes[i];\n              this.nodeMap[node.name] = node;\n            }\n          }\n          return this.nodeMap[name];\n        },\n        observe: function(name, value) {\n          var node = this.node(name);\n          if(node) {\n            var index = node.valueIndex(value);\n            if(index >= 0) {\n              node.isObserved = true;\n              node.value = index;\n            } else {\n              console.error('could not find value ' + value + ' for node ' + name);\n            }\n          } else {\n            console.error('could not find node with name ' + name);\n          }\n        },\n        unobserve: function(name) {\n          var node = this.node(name);\n          if(node) {\n            node.isObserved = false;\n            node.value = -1;\n          }\n        },\n        addNode: function(name, values) {\n          var node = {\n            name: name,\n            values: values,\n            value: -1,\n            parents: [],\n            wasSampled: false,\n            sampledLw: undefined,\n            addParent: function(parent) {\n              this.parents.push(parent);\n              this.dirty = true;\n              return this;\n            },\n            valueIndex: function(v) {\n              if(!this.valueIndexMap) {\n                this.valueIndexMap = {};\n                for(var i=0; i < this.values.length; i++) {\n                  var value = this.values[i];\n                  this.valueIndexMap[value] = i;\n                }\n              }\n              return this.valueIndexMap[v];\n            },\n            initSampleLw: function() {\n              this.sampledLw = undefined;\n            },\n            sampleLw: function() {\n              if(this.wasSampled) {\n                return 1;\n              }\n\n              var fa = 1;\n              for(var h=0; h < this.parents.length; h++) {\n                var pa = this.parents[h];\n                var pSampleLw = pa.sampleLw();\n                fa *= pSampleLw;\n              }\n\n              this.wasSampled = true;\n\n              var dh = this.cpt;\n              for(var h=0; h < this.parents.length; h++) {\n                var p = this.parents[h];\n                var v = p.value;\n                dh = dh[v];\n              }\n\n              if(this.value != -1) {\n                var v = dh[this.value];\n                fa *= v;\n              } else {\n                var fv = Math.random();\n                for(var h=0; h < dh.length; h++) {\n                  var v = dh[h];\n                  fv -= v;\n                  if(fv < 0) {\n                    this.value = h;\n                    break;\n                  }\n                }\n              }\n\n              return fa;\n            },\n            saveSampleLw: function(f) {\n              if(!this.sampledLw) {\n                this.sampledLw = new Array(this.values.length);\n                for(var h=this.values.length-1; h >= 0; h--) {\n                  this.sampledLw[h] = 0;\n                }\n              }\n              this.sampledLw[this.value] += f;\n            },\n            setCpt: function(probs) {\n              if(this.parents.length === 0) {\n                this.cpt = normalizeProbs(probs);\n              } else {\n                this.cpt = initNodeCpt(this.values, this.parents, normalizeCpts(probs));\n              }\n            },\n            probs: function() {\n              if(!this.sampledLw) {\n                return [];\n              }\n              var sum = 0.0;\n              var probs = [];\n              for(var i=0; i < this.sampledLw.length; i++) {\n                var s = this.sampledLw[i];\n                sum += s;\n                probs.push(s);\n              }\n              for(var i=0; i < this.sampledLw.length; i++) {\n                probs[i] = probs[i] / sum;\n              }\n              return probs;\n            }\n          }\n          this.nodes.push(node);\n          return node;\n        }\n      };\n    }\n\n    jsbayes.toMessage = function(g) {\n      var nodes = {};\n      var parents = {};\n\n      for(var i=0; i < g.nodes.length; i++) {\n        var n = g.nodes[i];\n        var node = {\n          name: n.name,\n          values: n.values,\n          value: n.value,\n          parents: [],\n          wasSampled: n.wasSampled,\n          sampledLw: n.sampledLw,\n          cpt: n.cpt\n        };\n        nodes[n.name] = node;\n\n        var pas = [];\n        for(var j=0; j < n.parents.length; j++) {\n          var pa = n.parents[j];\n          pas.push(pa.name);\n        }\n        parents[n.name] = pas;\n      }\n\n      var msg = {\n        samples: 10000,\n        nodes: nodes,\n        parents: parents\n      };\n\n      return JSON.stringify(msg);\n    }\n\n    return jsbayes;\n  }\n\n  if(typeof module === 'object' && module && typeof module.exports === 'object') {\n    module.exports = defineLib();\n  } else {\n    if(typeof(jsbayes) === 'undefined') {\n      window.jsbayes = defineLib();\n    }\n\n    if(typeof define === 'function' && define.amd) {\n      define('jsbayes', [], defineLib());\n    }\n  }\n}\n)(this);"]}